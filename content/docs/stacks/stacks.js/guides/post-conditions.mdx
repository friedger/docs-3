---
title: Deep dive into post-conditions
description: This guide explains how to use post-conditions to secure your smart contracts.
---

import { Badge } from '@/components/ui/badge';

import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';
import { ChevronRight, Code, Terminal } from 'lucide-react';
import { File, Folder, Files } from 'fumadocs-ui/components/files';
import { Step } from 'fumadocs-ui/components/steps';

import { GridPattern } from "@/components/grid-pattern";
import { ConnectWalletButton } from '@/components/code/connect-wallet-button';

import { InlineCode } from '@/components/inline-code';

Post-conditions in Stacks transactions provide an additional layer of security. They ensure that transactions execute as expected without requiring the user to know the underlying smart contract code.

In this guide, you will learn how to:

1. Construct post-conditions.
2. Use post-conditions.
3. Set the post-condition mode.
4. Use the legacy methods/enums.

---

### Constructing post-conditions

In Stacks.js, post-conditions can be constructed using the Pc helpers. These are inspired by Behavior Driven Development (BDD).

Start with the `Pc.address` initializer to specify the address of the principal that will be verified in the post-condition. Then auto-complete the rest of the post-condition.

```ts twoslash
// @noErrors
// [!code word:Pc]
import { Pc } from '@stacks/transactions';

const postCondition = Pc.principal('STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6')
  .willSendEq(1000)
  .ustx();
```

### Using post-conditions

Post-conditions can be added to contract calls and FT/NFT transfers to ensure assets are transferred as specified.

```ts twoslash
// @noErrors
import { Pc } from '@stacks/transactions';

const postCondition = Pc.principal('STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6')
  .willSendEq(1000)
  .ustx();
```

### Setting the post-condition mode

When creating a transaction, the mode of the transaction can be set to `Allow` or `Deny` to specify whether unspecified asset transfers are permitted.

```ts twoslash
// @noErrors
// [!code word:PostConditionMode]
import { PostConditionMode } from '@stacks/transactions';

const tx = await makeContractCall({
  // ...
  postConditionMode: PostConditionMode.Allow,
  // OR
  postConditionMode: PostConditionMode.Deny,
  // ...
});
```

### Legacy methods/enums

Legacy methods and enums can be used interchangeably with the builder methods.

```ts twoslash
// @noErrors
// [!code word:createSTXPostCondition]
import { createSTXPostCondition, FungibleConditionCode } from '@stacks/transactions';

const postCondition = createSTXPostCondition(
  "STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6",
  FungibleConditionCode.Equal,
  1000
);
```

Some other examples can be found below:

- [`createSTXPostCondition`](https://stacks.js.org/functions/_stacks_transactions.createSTXPostCondition) Builder method
- [`createFungiblePostCondition`](https://stacks.js.org/functions/_stacks_transactions.createFungiblePostCondition) Builder method
- [`createNonFungiblePostCondition`](https://stacks.js.org/functions/_stacks_transactions.createNonFungiblePostCondition) Builder method
- [`FungibleConditionCode`](https://stacks.js.org/enums/_stacks_transactions.FungibleConditionCode) Enum
- [`NonFungibleConditionCode`](https://stacks.js.org/enums/_stacks_transactions.NonFungibleConditionCode) Enum

<Callout>
Use the `Pc` helpers to construct post-conditions in a clear and concise manner.
</Callout>

### Code examples

`Amount uSTX Sent`

Construct a post-condition for a certain amount of uSTX to be sent.

<Tabs id="eq-ustx" items={["Pc","Legacy"]}>
  <Tab value={"Pc"}>
    ```ts twoslash
    // @noErrors
    // [!code word:willSendEq]
    import { Pc } from '@stacks/transactions';

    const postCondition = Pc.principal('STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6')
      .willSendEq(1000)
      .ustx();
    ```
  </Tab>
  <Tab value={"Legacy"}>
    ```ts twoslash
    // @noErrors
    // [!code word:Equal]
    import { createSTXPostCondition, FungibleConditionCode } from '@stacks/transactions';

    const postCondition = createSTXPostCondition(
      "STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6",
      FungibleConditionCode.Equal,
      1000
    );
    ```
  </Tab>
</Tabs>

`Amount FT Sent`

Construct a post-condition for a certain amount of a specific FT to be sent.

<Tabs id="gte-ft" items={["Pc","Legacy"]}>
  <Tab value={"Pc"}>
    ```ts twoslash
    // @noErrors
    // [!code word:willSendGte]
    import { Pc } from '@stacks/transactions';

    const postCondition = Pc.principal('STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6.token-ft')
      .willSendGte(500)
      .ft('STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6.token-ft', 'token');
```
  </Tab>
  <Tab value={"Legacy"}>
    ```ts twoslash
    // @noErrors
    // [!code word:GreaterEqual]
    import { createSTXPostCondition, FungibleConditionCode } from '@stacks/transactions';

    const postCondition = createSTXPostCondition(
      "STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6.token-ft",
      FungibleConditionCode.GreaterEqual,
      500,
      "STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6.token-ft::token"
    );
    ```
  </Tab>
</Tabs>

`Amount NFT Sent`

Construct a post-condition for sending / not-sending a specific NFT.

<Tabs id="post-condition-examples" items={["Pc","Legacy"]}>
  <Tab value={"Pc"}>
    ```ts twoslash
    // @noErrors
    // [!code word:willNotSendAsset]
    import { Pc } from '@stacks/transactions';

    const postCondition = Pc.principal('STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6')
      .willNotSendAsset()
      .nft('STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6.token-nft::token', Cl.uint(12));
```
  </Tab>
  <Tab value={"Legacy"}>
    ```ts twoslash
    // @noErrors
    // [!code word:DoesNotSend]
    import { createNonFungiblePostCondition, NonFungibleConditionCode } from '@stacks/transactions';

    const postCondition = createNonFungiblePostCondition(
      "STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6",
      NonFungibleConditionCode.DoesNotSend,
      "STB44HYPYAT2BB2QE513NSP81HTMYWBJP02HPGK6.token-nft::token",
      Cl.uint(12)
    );
    ```
  </Tab>
</Tabs>

<Callout type="warn">
Post-conditions can only ensure the transfer of assets and cannot guarantee the end-state after a transaction. To learn more, read the [post-conditions](/stacks/stacks.js/guides/post-conditions) guide.
</Callout>
